@model IList<Lotto.Models.Poll_Detail>
@{
    ViewBag.Title = "List";
    Layout = "~/Views/Shared/_User.cshtml";
}
@{
    var pollCount = 0;
    var receive = "รับแล้ว";
    var amount = 0;
    var total_amount = 0;
    var amount_receive = 0;
    var total_receive = 0;
    var discount = 0;
    var total_discount = 0;
    var reject_amount = 0;
}
<h2>ดูโพย</h2>
<hr />

<div class="row">
    <div class="col-md-12">
        <div class="card lotto-status">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        หวยรัฐบาล : <b><span id="todayDate"></span></b>
                    </div>
                    <div class="col-md-3">
                        ปิดเวลา : <b><span id="closeTime"></span></b>
                    </div>
                    <div class="col-md-3">
                        สถานะ : <b><span id="lottoStatus"></span></b>
                    </div>
                    <div class="col-md-3">
                        ยอดแทง : <b><span id="totalBetCount"></span></b>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <strong class="card-title">โพยทั้งหมด</strong>
            </div>
            <div class="card-body">
                <table id="bootstrap-data-table" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>โพยใบที่</th>
                            <th>สถานะ</th>
                            <th>ยอดแทง</th>
                            <th>ยอดรับ</th>
                            <th>ยอดหัก%</th>
                            <th>ยอดถูก</th>
                            <th>วันที่ส่ง</th>
                            <th>วันที่รับ</th>
                            <th><button type="button" class="btn btn-sm btn-secondary">พิมพ์โพย</button></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            pollCount += 1;
                            if (item.Receive == "1")
                            {
                                receive = "รับแล้ว";
                                amount = Int32.Parse(item.Amount);
                                amount_receive = Int32.Parse(item.Amount);
                                discount = Int32.Parse(item.Discount);
                                total_amount += amount;
                                total_receive += amount_receive;
                                total_discount += discount;
                            }
                            else
                            {
                                receive = "คืนทั้งใบ";
                                amount = Int32.Parse(item.Amount);
                                total_amount += amount;
                                amount_receive = 0;
                                total_receive += amount_receive;
                                reject_amount += amount;
                            }
                            <tr>
                                <td>@pollCount</td>
                                <td>@receive</td>
                                <td>@amount</td>
                                <td>@amount_receive</td>
                                <td>@discount</td>
                                <td>0</td>@*-------------------------- ตรวจเลขถูก  -----------------------------*@
                                <td>@item.create_date</td>
                                <td>@item.create_date</td>
                                <td><button type="button" class="btn btn-sm btn-primary showPoll" data-reject="@reject_amount" data-cBy="@item.Create_By" data-cDate="@item.create_date" data-toggle="modal" data-discount="@discount" data-areceiv="@amount_receive" data-amount="@amount" data-receive="@receive" data-pCount="@pollCount" data-id="@item.ID" data-target="#checkModal">ดูโพย</button></td>
                            </tr>
                        }
                    </tbody>
                    <tfoot>
                        <tr>
                            <th>รวม</th>
                            <th>@pollCount ใบ</th>
                            <th>@total_amount</th>
                            <th>@total_receive</th>
                            <th>@total_discount</th>
                            <th>0</th>@*-------------------------- ตรวจเลขถูก  -----------------------------*@
                            <th>สรุป</th>
                            <th>@total_discount</th>
                            <th><button type="button" class="btn btn-sm btn-success">สรุปยอด</button></th>
                        </tr>
                    </tfoot>
                </table>
                <input type="hidden" id="totalPollcount" value="@pollCount" />
                <input type="hidden" id="total_amount" value="@total_amount" />
                <input type="hidden" id="total_receive" value="@total_receive" />
                <input type="hidden" id="total_discount" value="@total_discount" />
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="checkModal" tabindex="-1" role="dialog" aria-labelledby="checkModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document" style="max-width:90%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="checkModalLabel">ตรวจเลข</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <form action="#" method="post" enctype="multipart/form-data" class="form-horizontal">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="row form-group">
                                        <div class="col col-md-5"><label for="text-input" class="form-control-label">โพยใบที่</label></div>
                                        <div class="col-12 col-md-7"><input type="text" id="poll_number" disabled name="text-input" class="form-control form-control-sm"></div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col col-md-5"><label for="text-input" class="form-control-label">สถานะ</label></div>
                                        <div class="col-12 col-md-7"><input type="text" id="receive_status" disabled name="text-input" class="form-control form-control-sm"></div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col col-md-5"><label for="text-input" class="form-control-label">ยอดแทงใบนี้</label></div>
                                        <div class="col-12 col-md-7"><input type="text" id="amount" disabled name="text-input" class="form-control form-control-sm"></div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col col-md-5"><label for="text-input" class="form-control-label">ยอดรับใบนี้</label></div>
                                        <div class="col-12 col-md-7"><input type="text" id="receive" disabled name="text-input" class="form-control form-control-sm"></div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col col-md-5"><label for="text-input" class="form-control-label">ยอดหัก%ใบนี้</label></div>
                                        <div class="col-12 col-md-7"><input type="text" id="discount" disabled name="text-input" class="form-control form-control-sm"></div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col col-md-5"><label for="text-input" class="form-control-label">วันที่แทง</label></div>
                                        <div class="col-12 col-md-7"><input type="text" id="poll_date" disabled name="text-input" class="form-control form-control-sm"></div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col col-md-5"><label for="text-input" class="form-control-label">แทงโดย</label></div>
                                        <div class="col-12 col-md-7"><input type="text" id="poll_by" disabled name="text-input" class="form-control form-control-sm"></div>
                                    </div>
                                    @*<div class="row form-group">
                                        <div class="col col-md-5"><label for="text-input" class="form-control-label">แทงจาก</label></div>
                                        <div class="col-12 col-md-7"><input type="text" id="text-input" name="text-input" class="form-control form-control-sm"></div>
                                    </div>*@
                                </div>
                                <div class="col-md-6">
                                    <div class="row form-group">
                                        <div class="col col-md-5"><label for="text-input" class="form-control-label">วันที่รับ</label></div>
                                        <div class="col-12 col-md-7"><input type="text" id="receive_date" disabled name="text-input" class="form-control form-control-sm"></div>
                                    </div>

                                    <div class="row form-group">
                                        <div class="col col-md-5"><label for="text-input" class="form-control-label">โพยหมายเลข</label></div>
                                        <div class="col-12 col-md-7"><input type="text" id="poll_id" disabled name="text-input" class="form-control form-control-sm"></div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col col-md-5"><label for="text-input" class="form-control-label">จำนวนโพย</label></div>
                                        <div class="col-12 col-md-7"><input type="text" id="total_poll" disabled name="text-input" class="form-control form-control-sm"></div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col col-md-5"><label for="text-input" class="form-control-label">รับแล้ว</label></div>
                                        <div class="col-12 col-md-7"><input type="text" id="receive_poll" disabled name="text-input" class="form-control form-control-sm"></div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col col-md-5"><label for="text-input" class="form-control-label">ยอดคืนงวดนี้</label></div>
                                        <div class="col-12 col-md-7"><input type="text" id="r_amount" disabled name="text-input" class="form-control form-control-sm"></div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col col-md-5"><label for="text-input" class="form-control-label">ยอดรับงวดนี้</label></div>
                                        <div class="col-12 col-md-7"><input type="text" id="receive_amount" disabled name="text-input" class="form-control form-control-sm"></div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col col-md-5"><label for="text-input" class="form-control-label">ยอดหัก%งวดนี้</label></div>
                                        <div class="col-12 col-md-7"><input type="text" id="t_discount" disabled name="text-input" class="form-control form-control-sm"></div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="col-md-12">
                        <div class="row" id="poll">
                            
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary">ตรวจ</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">ยกเลิก</button>
            </div>
        </div>
    </div>
</div>
<script src="~/Assets/js/list.js"></script>
<script>
    getPoll = '@Url.Action("getPoll", "User")';
    (function ($) {
        $('#bootstrap-data-table').DataTable({
            lengthMenu: [[10, 20, 50, -1], [10, 20, 50, "All"]],
            fixedHeader: {
                footer: true
            }
        });
    })(jQuery);
</script>

