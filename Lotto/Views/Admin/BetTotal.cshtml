@model IList<Lotto.Models.total_bet>
@{
    ViewBag.Title = "BuyTotal";
    Layout = "~/Views/Shared/_Admin.cshtml";
}

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <i class="mr-2 fa fa-file-text-o"></i>
                <strong class="card-title">ยอดสรุปเป็นใบ</strong>
            </div>
            <div class="card-body">
                <table id="bootstrap-data-table" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>สมาชิก</th>
                            <th>โพยทั้งหมด</th>
                            <th>รับแล้ว</th>
                            <th>ยอดแทง</th>
                            <th>ยอดรับ</th>
                            <th>ยอดหัก%</th>
                            <th>ยอดถูก</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            if (item.UID != "0")
                            {
                                var totalPoll = Int32.Parse(item.Reject) + Int32.Parse(item.Receive);
                                <tr>
                                    <td>@item.Name</td>
                                    <td>@totalPoll</td>
                                    <td>@item.Receive</td>
                                    <td>@item.Amount</td>
                                    <td>@item.AmountReceive</td>
                                    <td>@item.AmountDiscount</td>
                                    <td>0</td>
                                    <td>
                                        <button type="button" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#totalBalance" data-backdrop="static" data-keyboard="false">สรุปยอด</button>
                                        <button type="button" class="btn btn-sm btn-success" data-toggle="modal" data-target="#totalKeep" data-backdrop="static" data-keyboard="false">ใบแจ้งยอด</button>
                                        <button type="button" class="btn btn-sm btn-warning get-user-poll" data-uid="@item.UID" data-toggle="modal" data-target="#checkPollModal" data-backdrop="static" data-keyboard="false">ดูโพย</button>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="checkPollModal" tabindex="-1" role="dialog" aria-labelledby="checkPollModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document" style="max-width:90%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="checkPollModalLabel">ดูโพย</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <table class="table table-striped table-bordered user-poll-data-table">
                    <thead></thead>
                    <tbody></tbody>
                    <!--<tfoot>
                        <tr>
                            <th>รวม</th>
                            <th><span id="pollCount"></span> ใบ</th>
                            <th></th>
                            <th></th>
                            <th><span id="total_amount"></span></th>
                            <th><span id="total_receive"></span></th>
                            <th><span id="total_discount"></span></th>
                            <th>0</th>
                            <th>สรุป</th>
                            <th><span id="total_discount"></span></th>
                        </tr>
                    </tfoot>-->
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="totalBalance" tabindex="-1" role="dialog" aria-labelledby="totalBalanceLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="totalBalanceLabel">ใบสรุปยอดเงิน</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="printBalanceArea">
                <table class="table table-bordered" style="text-align:center;">
                    <thead style="color:white;background-color:blue;">
                        <tr>
                            <th rowspan="2">ชนิด</th>
                            <th colspan="3">ยอดทั้งหมด</th>
                            <th colspan="3">แทงออก</th>
                            <th colspan="3">รับไว้</th>
                        </tr>
                        <tr>
                            <th>แทงหัก %</th>
                            <th>ถูก</th>
                            <th>สุทธิ</th>
                            <th>แทงหัก %</th>
                            <th>ถูก</th>
                            <th>สุทธิ</th>
                            <th>แทงหัก %</th>
                            <th>ถูก</th>
                            <th>สุทธิ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>2 บน</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>3 บน</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>3 โต๊ด</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>2 โต๊ด</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>3 หน้า</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>3 หน้าโต๊ด</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>วิ่ง บน</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>วื่ง ล่าง</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>2 ล่าง</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>3 ล่าง</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                    <tfoot style="color:white;background-color:blue;">
                        <tr>
                            <td>รวม</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="printBalance">พิมพ์</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">ปิด</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="totalKeep" tabindex="-1" role="dialog" aria-labelledby="totalKeepLabel" aria-hidden="true">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="totalKeepLabel">ใบสรุปยอดเก็บ</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="printKeepArea">
                <div class="row">
                    <div class="col-md-3">
                        หวยรัฐบาล
                    </div>
                    <div class="col-md-1">
                        -
                    </div>
                    <div class="col-md-2">
                        80000
                    </div>
                    <div class="col-md-1">
                        -
                    </div>
                    <div class="col-md-2">
                        60000
                    </div>
                    <div class="col-md-1">
                        -
                    </div>
                    <div class="col-md-2">
                        คน
                    </div>
                    <div class="col-md-12">
                        <hr />
                        <table class="table table-bordered" style="text-align:center;">
                            <thead style="color:white;background-color:blue;">
                                <tr>
                                    <th>ยอดเก็บ</th>
                                    <th>ยอดจ่าย</th>
                                    <th>หมายเลข - ชื่อ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </tbody>
                            <tfoot style="color:white;background-color:blue;">
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="printKeep">เปิด</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">ยกเลิก</button>
            </div>
        </div>
    </div>
</div>

<script>
    (function ($) {

        getUserPoll = '@Url.Action("List", "Admin")';

        $('#bootstrap-data-table').DataTable({
            lengthMenu: [[10, 20, 50, -1], [10, 20, 50, "All"]],
        });

        var pollTable = $('.user-poll-data-table').DataTable({
            "lengthMenu": [[10, 20, 50, -1], [10, 20, 50, "All"]],
            "paging": true,
            "lengthChange": true,
            "searching": true,
            "ordering": true,
            "info": true,
            "autoWidth": true,
            "data": [],
            "columns": [
            {
                "title": "สมาชิก",
                "data": "name"
            },
            {
                "title": "โพยใบที่",
                "data": "poll_number"
            },
            {
                "title": "หมายเลขโพย",
                "data": "ID"
            },
            {
                "title": "สถานะ",
                "data": "Receive"
            },
            {
                "title": "ยอดแทง",
                "data": "Amount"
            },
            {
                "title": "ยอดรับ",
                "data": "Amount"
            },
            {
                "title": "ยอดหัก%",
                "data": "Discount"
            },
            {
                "title": "ยอดถูก",
                "data": "gg",
                "defaultContent": "0"
            },
            {
                "title": "วันที่ส่ง",
                "data": "create_date"
            },
            {
                "title": "วันที่ส่ง",
                "data": null,
                "defaultContent": "<button type='button' class='btn btn-sm btn-primary get-poll'>ดูโพย</button>"
            },
            {
                "title": "user",
                "visible": false,
                "searchable": false,
                "data":"UID"
            }
            ]
        });

        $(".get-user-poll").click(function () {
            var id = $(this).data('uid');
            $.ajax({
                url: getUserPoll,
                data: { UID: id },
                type: "POST",
                dataType: "json",
                success: function (data) {
                    //alert(JSON.stringify(data));

                    var pollCount = 0;
                    var receive = "รับแล้ว";
                    var amount = 0;
                    var total_amount = 0;
                    var amount_receive = 0;
                    var total_receive = 0;
                    var discount = 0;
                    var total_discount = 0;
                    var reject_amount = 0;

                    pollTable.clear();
                    $.each(data, function (index, value) {
                        //console.log(value.Receive);
                        if (value.Receive == "1")
                        {
                            value.Receive = "รับแล้ว";
                            //amount = value.Amount;
                            //amount_receive = value.Amount;
                            //discount = value.Discount;
                            //value.total_amount += amount;
                            //value.total_receive += amount_receive;
                            //value.total_discount += discount;
                        }
                        else
                        {
                            value.Receive = "คืนทั้งใบ";
                            //amount = value.Amount;
                            //amount_receive = 0;
                            //value.discount = 0;
                            //value.total_amount += amount;
                            //value.total_receive += amount_receive;
                            //value.reject_amount += amount;
                        }
                        pollTable.row.add(value);
                    });
                    pollTable.draw();
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert("error");
                }
            });
        });

        $(".get-poll").click(function () {

        });
    })(jQuery);
</script>

